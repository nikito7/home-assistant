# /config/pkg/template.yaml

template:
#
  - sensor:
#
    - name: "Tempo de Disparo ICP"
      icon: "mdi:skull-crossbones-outline"
      state: >-
        {% set watts = states('sensor.eb3_active_power_import')|float(1) %}
        {% set pf = states('sensor.eb3_power_factor')|float(1) %} 
        {% set potencia_inst = watts/pf %}
        {% set potencia_max_kva = 1150 %}
        {% set q_factor = 50 %}
        {% set k_factor = 1.2 %}
        {% if potencia_inst > potencia_max_kva*k_factor %}
          {{ (q_factor/((potencia_inst/potencia_max_kva)-k_factor))|int(0)|round(0) }}
        {% else %}
          {{ 0 }}
        {% endif %}
      unit_of_measurement: 's'

# EOF
