# /config/pkg/template.yaml

template:
#
  - sensor:
#
# k_factor = mono 120; tri 130.
#
    - name: "Tempo de Disparo ICP"
      icon: "mdi:target-variant"
      state: >-
        {% set watts = states('sensor.eb3_active_power_import')|float(1) %}
        {% set pf = states('sensor.eb3_power_factor')|float(1) %} 
        {% set potencia_inst = (watts/pf) %}
        {% set potencia_max_kva = (10.35*1000) %}
        {% set q_factor = 50 %}
        {% set k_factor = (130/100) %}
        {% if potencia_inst > potencia_max_kva*k_factor %}
          {{ (q_factor/((potencia_inst/potencia_max_kva)-k_factor))|int(0)|round(0) }}
        {% else %}
          {{ 0 }}
        {% endif %}
      unit_of_measurement: 's'

    - name: "Tempo de Disparo ICP L1"
      icon: "mdi:target-variant"
      state: >-
        {% set watts = states('sensor.eb3_active_power_l1')|float(1) %}
        {% set pf = states('sensor.eb3_power_factor_l1')|float(1) %} 
        {% set potencia_inst = (watts/pf) %}
        {% set potencia_max_kva = (10.45*1000/3) %}
        {% set q_factor = 50 %}
        {% set k_factor = (130/100) %}
        {% if potencia_inst > potencia_max_kva*k_factor %}
          {{ (q_factor/((potencia_inst/potencia_max_kva)-k_factor))|int(0)|round(0) }}
        {% else %}
          {{ 0 }}
        {% endif %}
      unit_of_measurement: 's'

    - name: "Tempo de Disparo ICP L2"
      icon: "mdi:target-variant"
      state: >-
        {% set watts = states('sensor.eb3_active_power_l2')|float(1) %}
        {% set pf = states('sensor.eb3_power_factor_l2')|float(1) %} 
        {% set potencia_inst = (watts/pf) %}
        {% set potencia_max_kva = (10.45*1000/3) %}
        {% set q_factor = 50 %}
        {% set k_factor = (130/100) %}
        {% if potencia_inst > potencia_max_kva*k_factor %}
          {{ (q_factor/((potencia_inst/potencia_max_kva)-k_factor))|int(0)|round(0) }}
        {% else %}
          {{ 0 }}
        {% endif %}
      unit_of_measurement: 's'

    - name: "Tempo de Disparo ICP L3"
      icon: "mdi:target-variant"
      state: >-
        {% set watts = states('sensor.eb3_active_power_l3')|float(1) %}
        {% set pf = states('sensor.eb3_power_factor_l3')|float(1) %} 
        {% set potencia_inst = (watts/pf) %}
        {% set potencia_max_kva = (10.45*1000/3) %}
        {% set q_factor = 50 %}
        {% set k_factor = (130/100) %}
        {% if potencia_inst > potencia_max_kva*k_factor %}
          {{ (q_factor/((potencia_inst/potencia_max_kva)-k_factor))|int(0)|round(0) }}
        {% else %}
          {{ 0 }}
        {% endif %}
      unit_of_measurement: 's'

# EOF
